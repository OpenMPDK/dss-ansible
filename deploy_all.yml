---

- name: Configure Servers
  hosts: servers
  pre_tasks:
    - name: Verify minimum Ansible version
      assert:
        that: "ansible_version.full is version_compare('2.9', '>=')"
        msg: "You must update Ansible to at least 2.9 to use this playbook"
      run_once: true
  roles:
    - validate_centos
    - deploy_kernel
    - deploy_nvme_cli
    - upgrade_kvssd_firmware
    - deploy_ofed
    - upgrade_connectx_firmware

- name: Configure VLANs
  import_playbook: configure_vlans.yml

- name: Deploy DSS software
  hosts: servers
  roles:
    - deploy_target
    - deploy_host
    - configure_target
