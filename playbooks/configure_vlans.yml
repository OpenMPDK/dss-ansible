---

- name: Set any_errors_fatal for all groups
  hosts:
    - servers
    - clients
    - onyx
  any_errors_fatal: true

- name: Get Onyx LLDP tables
  hosts: onyx
  connection: network_cli
  gather_facts: false
  become: true
  become_method: enable
  vars:
    ansible_network_os: onyx
  roles:
    - get_onyx_lldp

- name: Configure host VLANs
  hosts:
    - servers
    - clients
  roles:
    - configure_host_vlans
    - configure_dcqcn
    - remove_packet_pacing

- name: Configure Onyx VLANs
  hosts: onyx
  connection: network_cli
  gather_facts: false
  become: true
  become_method: enable
  vars:
    ansible_network_os: onyx
  roles:
    - configure_onyx_vlans
