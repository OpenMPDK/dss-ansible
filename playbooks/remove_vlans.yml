---

- name: Set any_errors_fatal for all groups
  gather_facts: false
  hosts:
    - servers
    - clients
    - onyx
  any_errors_fatal: true

- name: Get Onyx LLDP tables
  hosts: onyx
  connection: network_cli
  gather_facts: false
  become: true
  become_method: enable
  vars:
    ansible_network_os: onyx
  roles:
    - get_onyx_lldp

- name: Remove ConnectX VLANs
  hosts:
    - servers
    - clients
  roles:
    - remove_host_vlans

- name: Remove Onyx allowed VLANs
  hosts: onyx
  connection: network_cli
  gather_facts: false
  become: true
  become_method: enable
  vars:
    ansible_network_os: onyx
  roles:
    - remove_onyx_allowed_vlans
