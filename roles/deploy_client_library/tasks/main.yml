---

- name: Install yum repos
  yum:
    name:
      - centos-release-scl
      - epel-release
  become: true

- name: Install yum dependencies
  yum:
    name:
      - devtoolset-9
      - git
      - zlib-devel
      - openssl-devel
      - libcurl-devel
      - libuuid-devel
      - pulseaudio-libs-devel
      - python3
      - python3-pip
      - python3-devel
      - cmake3
  become: true

- name: Set symlink for cmake3
  file:
    src: /usr/bin/cmake3
    dest: /usr/bin/cmake
    state: link
    force: true
  become: true

- name: Stat aws-sdk-cpp libs
  stat:
    path: /usr/local/lib64/libaws-c-common.so
  register: libaws_libs

- name: Build aws-sdk-cpp
  include_tasks: build_libaws.yml
  when: not libaws_libs.stat.exists
