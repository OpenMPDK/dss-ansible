---

- name: Create aws-sdk-cpp staging directory
  file:
    path: "{{ aws_sdk_cpp_staging_dir }}"
    state: directory
    mode: 0755

- name: Download aws-sdk-cpp source
  unarchive:
    src: "{{ aws_sdk_cpp_url }}"
    dest: "{{ aws_sdk_cpp_staging_dir }}"
    mode: 0754
    remote_src: true
    extra_opts: [--strip-components=1]

- name: Create aws-sdk-cpp build dir
  file:
    path: "{{ aws_sdk_cpp_staging_dir }}/build"
    state: directory
    mode: 0755

- name: cmake aws-sdk-cpp
  shell: >
    source scl_source enable devtoolset-9 &&
    cmake ../
    -DCMAKE_CXX_COMPILER=g++
    -DCMAKE_BUILD_TYPE=Release
    -DBUILD_ONLY="s3"
  args:
    chdir: "{{ aws_sdk_cpp_staging_dir }}/build"

- name: make aws-sdk-cpp
  shell: >
    source scl_source enable devtoolset-9 &&
    make
  args:
    chdir: "{{ aws_sdk_cpp_staging_dir }}/build"

- name: make install aws-sdk-cpp
  shell: >
    source scl_source enable devtoolset-9 &&
    make install
  args:
    chdir: "{{ aws_sdk_cpp_staging_dir }}/build"
  become: true

- name: Remove aws-sdk-cpp staging directory
  file:
    path: "{{ aws_sdk_cpp_staging_dir }}"
    state: absent
    mode: 0755
