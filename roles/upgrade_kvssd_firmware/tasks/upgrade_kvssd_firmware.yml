---

- name: nvme fw-download {{ kvssd_device_path }} -i {{ kvssd_fw_bin }}
  command: "nvme fw-download {{ kvssd_device_path }} -f {{ kvssd_fw_bin }}"
  become: true  # noqa 301

- name: nvme fw-activate {{ kvssd_device_path }} -s 0 -a 1
  command: "nvme fw-activate {{ kvssd_device_path }} -s 0 -a 1"
  register: fw_activate
  until:
    - '"Resource temporarily unavailable" not in fw_activate.stderr'
    - '"Interrupted system call" not in fw_activate.stderr'
    - '"The command was aborted due to a Command Abort request" not in fw_activate.stderr'
  become: true  # noqa 301

- name: nvme reset {{ kvssd_device_path }}
  command: "nvme reset {{ kvssd_device_path }}"
  become: true  # noqa 301
