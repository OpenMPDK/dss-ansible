---

- name: Generate cluster.json template to master client
  template:
    src: cluster.json.j2
    dest: "{{ start_dss_benchmark_dest_dir }}/cluster.json"
  become: true
  run_once: true

- name: Copy image.json to master client
  copy:
    src: image.json
    dest: "{{ start_dss_benchmark_dest_dir }}/image.json"
  become: true
  run_once: true

- name: Execute generate on master client
  command: >
    python3
    {{ start_dss_benchmark_dest_dir }}/scripts/bench.py
    generate
    --cluster-config {{ start_dss_benchmark_dest_dir }}/cluster.json
    --obj-dist-file {{ start_dss_benchmark_dest_dir }}/image.json
    --objects 1000
    --warp-binary {{ start_dss_benchmark_dest_dir }}/warp
    --output-dir {{ start_dss_benchmark_log_dir }}
  become: true
  run_once: true

- name: Execute benchmark on master client
  command: >
    python3
    {{ start_dss_benchmark_dest_dir }}/scripts/bench.py
    benchmark
    --num_clients 1
    --warp-binary {{ start_dss_benchmark_dest_dir }}/warp
    --access-key minio
    --secret-key minio123
    --output-dir {{ start_dss_benchmark_log_dir }}
    --duration 60s
    --concurrent 1
    --cluster-config
    --cluster-config {{ start_dss_benchmark_dest_dir }}/cluster.json
  become: true
  run_once: true
