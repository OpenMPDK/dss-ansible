---

- name: Identify UEFI boot
  stat:
    path: /sys/firmware/efi
  register: uefi

- name: Execute grub2-mkconfig
  command: "grub2-mkconfig -o {{ grubpath }}"
  become: true
  vars:
    grubpath: "/boot/{% if uefi.exists %}efi/EFI/centos{% else %}grub2{% endif %}/grub.cfg"

- name: Reboot system
  reboot:
    reboot_timeout: "{{ reboot_timeout }}"
  become: true

- name: Gather facts post-reboot
  setup:
